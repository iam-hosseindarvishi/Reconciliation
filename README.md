# سیستم مغایرت‌گیری بانک، پوز و حسابداری

این برنامه یک سیستم مغایرت‌گیری خودکار بین تراکنش‌های بانکی، تراکنش‌های پوز و ورودی‌های حسابداری است که با استفاده از Python و PySide6 پیاده‌سازی شده است.

## ویژگی‌ها

- بارگذاری و پردازش فایل‌های اکسل بانک، پوز و حسابداری
- مغایرت‌گیری خودکار بین تراکنش‌های بانکی و پوز (شاپرک)
- مغایرت‌گیری چک‌ها و انتقال‌های بانکی با ورودی‌های حسابداری
- تلاش برای مغایرت‌گیری تراکنش‌های پوز با ورودی‌های حسابداری
- پیشنهاد مغایرت‌گیری بر اساس شباهت شماره کارت
- تولید گزارش‌های PDF از نتایج مغایرت‌گیری
- رابط کاربری گرافیکی با پشتیبانی کامل از زبان فارسی

## پیش‌نیازها

- Python 3.8 یا بالاتر
- PySide6
- SQLite3
- pandas
- xlrd (برای خواندن فایل‌های .xls)
- openpyxl (برای خواندن فایل‌های .xlsx)
- reportlab (برای تولید گزارش‌های PDF)
- jdatetime (برای تبدیل تاریخ شمسی)

## نصب

1. کلون کردن مخزن:

```bash
git clone https://github.com/username/reconciliation-app.git
cd reconciliation-app
```

2. نصب وابستگی‌ها:

```bash
pip install -r requirements.txt
```

3. قرار دادن فونت فارسی:
   - فایل فونت `BNazanin.ttf` را در پوشه `config/fonts` قرار دهید.

## ساختار پروژه

```
project_root/
  ├── main_app.py          # نقطه ورود اصلی برنامه
  ├── modules/             # ماژول‌های برنامه
  │   ├── data_loader.py   # بارگذاری داده از فایل‌های اکسل
  │   ├── database_manager.py # مدیریت پایگاه داده SQLite
  │   ├── reconciliation_logic.py # منطق مغایرت‌گیری
  │   ├── report_generator.py # تولید گزارش‌های PDF
  │   ├── logger.py        # سیستم ثبت وقایع
  │   └── utils.py         # توابع کمکی
  ├── ui/                  # رابط کاربری
  │   ├── main_window.py   # پنجره اصلی برنامه
  │   └── ui_elements.py   # المان‌های رابط کاربری
  ├── config/              # تنظیمات برنامه
  │   ├── config.py        # تنظیمات پیکربندی
  │   ├── splash.svg       # تصویر صفحه شروع
  │   └── fonts/           # فونت‌های فارسی
  ├── data/                # داده‌ها و فایل‌های لاگ
  │   ├── reconciliation_db.sqlite # پایگاه داده
  │   ├── activity.log     # لاگ فعالیت‌ها
  │   └── errors.txt       # لاگ خطاها
  └── reports/             # گزارش‌های تولید شده
```

## نحوه استفاده

1. اجرای برنامه:

```bash
python main_app.py
```

2. در تب «ورود داده»:
   - فایل اکسل بانک (.xls) را انتخاب کنید
   - پوشه حاوی فایل‌های پوز (.xlsx) را انتخاب کنید
   - فایل اکسل حسابداری (.xls) را انتخاب کنید
   - دکمه «ورود داده» را بزنید

3. در تب «مغایرت‌گیری»:
   - دکمه «شروع مغایرت‌گیری» را بزنید
   - نتایج مغایرت‌گیری در لاگ و جدول نمایش داده می‌شود
   - می‌توانید رکوردهای مغایرت‌گیری نشده را به صورت دستی مغایرت‌گیری کنید

4. در تب «گزارش‌ها»:
   - گزارش‌های مختلف را با کلیک بر روی دکمه‌های مربوطه تولید کنید
   - گزارش‌ها در پوشه `reports` ذخیره می‌شوند

## مغایرت‌گیری

سیستم مغایرت‌گیری به صورت خودکار موارد زیر را انجام می‌دهد:

1. **مغایرت‌گیری شاپرک (پوز)**:
   - تطبیق تراکنش‌های بانکی با نوع «واریز پوز» با رکوردهای پوز
   - تاریخ پوز = تاریخ بانک - 1 روز
   - مبالغ یکسان
   - شناسه ترمینال یکسان

2. **مغایرت‌گیری چک**:
   - تطبیق چک‌های بانکی با چک‌های حسابداری
   - نوع یکسان
   - مبلغ یکسان
   - شماره حساب در توضیحات بانک

3. **مغایرت‌گیری انتقال**:
   - تطبیق انتقال‌های بانکی با انتقال‌های حسابداری
   - تاریخ یکسان
   - مبلغ یکسان
   - تطبیق اختیاری بر اساس پسوند شماره پیگیری

4. **مغایرت‌گیری پوز با حسابداری**:
   - تلاش برای تطبیق تراکنش‌های پوز باقیمانده با ورودی‌های حسابداری
   - مبلغ یکسان
   - تاریخ با تلرانس ±1 روز
   - شناسه ترمینال

5. **پیشنهاد بر اساس پسوند کارت**:
   - پیشنهاد (نه تطبیق خودکار) تراکنش‌های پوز با ورودی‌های حسابداری بر اساس 4 رقم آخر شماره کارت

## گزارش‌ها

سیستم قادر به تولید گزارش‌های زیر است:

1. تراکنش‌های بانکی مغایرت‌گیری نشده
2. ورودی‌های حسابداری مغایرت‌گیری نشده
3. تراکنش‌های پوز که در حسابداری نیستند
4. ورودی‌های پوز حسابداری که در پوز نیستند
5. ورودی‌های تکراری حسابداری
6. گزارش خلاصه مغایرت‌گیری

## مجوز

این پروژه تحت مجوز MIT منتشر شده است. برای اطلاعات بیشتر، فایل LICENSE را مشاهده کنید.